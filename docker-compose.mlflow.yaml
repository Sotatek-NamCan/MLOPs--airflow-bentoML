version: "3.8"

services:
  mlflow-server:
    image: ghcr.io/mlflow/mlflow:v2.16.0
    container_name: mlflow-server
    ports:
      - "5000:5000"
    command: >
      mlflow server
      --host 0.0.0.0
      --port 5000
      --backend-store-uri ${MLFLOW_BACKEND_URI:-sqlite:////mlflow/mlflow.db}
      --default-artifact-root ${MLFLOW_ARTIFACT_ROOT:-file:/mlflow/artifacts}
    environment:
      AWS_ACCESS_KEY_ID: ${OBJECT_STORAGE_ACCESS_KEY:-}
      AWS_SECRET_ACCESS_KEY: ${OBJECT_STORAGE_SECRET_KEY:-}
      AWS_DEFAULT_REGION: ${OBJECT_STORAGE_REGION:-}
      MLFLOW_S3_ENDPOINT_URL: ${OBJECT_STORAGE_ENDPOINT_URL:-}
    volumes:
      - ./mlflow_data:/mlflow
    restart: unless-stopped
